<div class="bg-white p-6 rounded-xl shadow-md max-w-4xl mx-auto">
    <h2 class="text-xl font-semibold mb-6 border-b pb-4"><?= e($title); ?></h2>
    <?php if (!empty($error)): ?>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <span class="block sm:inline"><?= e($error); ?></span>
        </div>
    <?php endif; ?>
    <form action="<?= APP_URL; ?>/orders/store" method="POST" enctype="multipart/form-data">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="user_id" class="block text-sm font-medium text-gray-700 mb-1">انتخاب مشتری <span class="text-red-500">*</span></label>
                <select name="user_id" id="user_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">یک مشتری را انتخاب کنید</option>
                    <?php foreach ($customers as $customer): ?>
                        <option value="<?= e($customer->id); ?>"><?= e($customer->full_name); ?></option>
                    <?php endforeach; ?>
                </select>
            </div>
            <div>
                <label for="title" class="block text-sm font-medium text-gray-700 mb-1">عنوان سفارش <span class="text-red-500">*</span></label>
                <input type="text" name="title" id="title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="مثال: کفش ورزشی نایک">
            </div>
            <div>
                <label for="source_site" class="block text-sm font-medium text-gray-700 mb-1">سایت مبدا</label>
                <select name="source_site" id="source_site" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">انتخاب سایت...</option>
                    <?php foreach ($sites as $site): ?>
                        <option value="<?= e($site->url); ?>"><?= e($site->name); ?></option>
                    <?php endforeach; ?>
                </select>
            </div>
            <!-- FIX: Added Product Link Input Field -->
            <div>
                <label for="product_link" class="block text-sm font-medium text-gray-700 mb-1">لینک محصول</label>
                <input type="url" name="product_link" id="product_link" class="w-full px-4 py-2 border border-gray-300 rounded-lg" placeholder="https://www.example.com/product-page">
            </div>
            <div>
                <label for="category_id" class="block text-sm font-medium text-gray-700 mb-1">دسته‌بندی</label>
                <select name="category_id" id="category_id" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">بدون دسته‌بندی</option>
                    <?php foreach ($categories as $category): ?>
                        <option value="<?= e($category->id); ?>"><?= e($category->name); ?></option>
                    <?php endforeach; ?>
                </select>
            </div>
            <div>
                <label for="image" class="block text-sm font-medium text-gray-700 mb-1">تصویر سفارش</label>
                <input type="file" name="image" id="image" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            <div>
                <label for="price_lira" class="block text-sm font-medium text-gray-700 mb-1">قیمت (لیر)</label>
                <input type="number" step="0.01" name="price_lira" id="price_lira" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label for="price_toman" class="block text-sm font-medium text-gray-700 mb-1">قیمت (تومان) <span class="text-red-500">*</span></label>
                <input type="number" step="1" name="price_toman" id="price_toman" required class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label for="quantity" class="block text-sm font-medium text-gray-700 mb-1">تعداد</label>
                <input type="number" name="quantity" id="quantity" value="1" min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label for="size" class="block text-sm font-medium text-gray-700 mb-1">سایز</label>
                <input type="text" name="size" id="size" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div>
                <label for="weight" class="block text-sm font-medium text-gray-700 mb-1">وزن (کیلوگرم)</label>
                <input type="number" step="0.01" name="weight" id="weight" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
            </div>
            <div class="md:col-span-2">
                <label for="description" class="block text-sm font-medium text-gray-700 mb-1">توضیحات</label>
                <textarea name="description" id="description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
            </div>
            <div class="md:col-span-2 flex items-center space-x-4 space-x-reverse">
                <div class="flex items-center">
                    <input id="apply_shipping" name="apply_shipping" type="checkbox" value="1" class="h-4 w-4 text-blue-600"><label for="apply_shipping" class="mr-2 block text-sm">اعمال هزینه باربری</label>
                </div>
                <div class="flex items-center">
                    <input id="with_cargo" name="with_cargo" type="checkbox" value="1" class="h-4 w-4 text-blue-600"><label for="with_cargo" class="mr-2 block text-sm">با کارگو</label>
                </div>
                <div class="flex items-center">
                    <input id="is_store_purchase" name="is_store_purchase" type="checkbox" value="1" class="h-4 w-4 text-blue-600"><label for="is_store_purchase" class="mr-2 block text-sm">خرید استور</label>
                </div>
            </div>
        </div>
        <div class="mt-8 pt-5 border-t flex justify-end">
            <a href="<?= APP_URL; ?>/orders" class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 ml-4">انصراف</a>
            <button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">ثبت سفارش</button>
        </div>
    </form>
</div>
